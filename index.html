<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inteligência de Mercado: Rio Verde 2025</title>
    
    <!-- 1. Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM (Core do App) -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Prop-types (Dependência necessária para Recharts) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- 4. Recharts (Biblioteca de Gráficos - Versão Compatível UMD) -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    
    <!-- 5. Babel (Tradutor de código para o navegador) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            background-color: #f8fafc; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        /* Z-Index alto para garantir que o tooltip do gráfico apareça sobre tudo */
        .recharts-tooltip-wrapper {
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="root">Carregando painel de inteligência...</div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Extraindo componentes do Recharts global
        // Nota: O nome correto aqui é 'Tooltip', não 'RechartsTooltip'
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, 
            Tooltip, ResponsiveContainer, Legend, BarChart, Bar, Cell 
        } = window.Recharts;

        // --- ÍCONES SVG ---
        const Icon = ({ d, className, color = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const Icons = {
            MapPin: (p) => <Icon {...p} d={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>} />,
            Droplets: (p) => <Icon {...p} d={<><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></>} />,
            Dumbbell: (p) => <Icon {...p} d={<><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></>} />,
            Users: (p) => <Icon {...p} d={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>} />,
            DollarSign: (p) => <Icon {...p} d={<><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></>} />,
            Calendar: (p) => <Icon {...p} d={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />,
            Info: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />,
            Target: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            BookOpen: (p) => <Icon {...p} d={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
            HelpCircle: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></>} />,
            FileText: (p) => <Icon {...p} d={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></>} />,
            Calculator: (p) => <Icon {...p} d={<><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>} />,
            Plus: (p) => <Icon {...p} d={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Trash2: (p) => <Icon {...p} d={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            RefreshCw: (p) => <Icon {...p} d={<><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></>} />,
            TrendingUp: (p) => <Icon {...p} d={<><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></>} />,
            AlertCircle: (p) => <Icon {...p} d={<><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></>} />,
            Lightbulb: (p) => <Icon {...p} d={<><line x1="12" x2="12" y1="2" y2="3"/><line x1="12" x2="12" y1="21" y2="22"/><line x1="4.22" x2="5.64" y1="4.22" y2="5.64"/><line x1="18.36" x2="19.78" y1="18.36" y2="19.78"/><line x1="1" x2="2" y1="12" y2="12"/><line x1="22" x2="23" y1="12" y2="12"/><line x1="4.22" x2="5.64" y1="19.78" y2="18.36"/><line x1="18.36" x2="19.78" y1="5.64" y2="4.22"/><path d="m16.8 15.5-.1.1a6 6 0 1 0-9.4 0l-.1.1a10 10 0 0 1-4.2-7 10 10 0 0 1 4.2-7 10 10 0 0 1 4.2 7 10 10 0 0 1-4.2 7"/></>} />,
            MousePointerClick: (p) => <Icon {...p} d={<><path d="m9 9 5 12 1.8-5.2L21 14Z"/><path d="M7.2 2.2 8 5.1"/><path d="m5.1 8-2.9-.8"/><path d="M14 4.1 12 6"/><path d="m6 12-1.9 2"/></>} />,
            Edit3: (p) => <Icon {...p} d={<><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></>} />,
            Hand: (p) => <Icon {...p} d={<><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></>} />
        };

        const SOURCES = {
            demografia: "Fonte: IBGE (Estimativa 2025: 241.494 habitantes).",
            economia: "Fonte: IBGE/IMB (Dados 2025: 2ª Maior Economia de Goiás).",
            zoneamento: "Fonte: Plano Diretor e Análise Imobiliária Local (Medeiros/Interlagos).",
            agro: "Fonte: CONAB (Calendário Safra Soja/Milho 23/24).",
            periodo: "Ref: Dados consolidados para planejamento 2025."
        };

        const CITY_STATS = {
            populacao: "241.494",
            pibPerCapita: "R$ 98.849",
            pibTotal: "R$ 22,3 Bilhões",
            posicaoGoias: "2º Maior PIB"
        };

        const ZONES = [
            {
                id: 'medeiros',
                name: 'Bairro Medeiros & Interlagos',
                type: 'Alta Renda / Elite do Agro',
                class: 'A+',
                income: '> 30 S.M.',
                description: 'Conhecido por ter uma das maiores concentrações de renda do Centro-Oeste. Mansões com áreas de lazer extensas e piscinas de grande porte (>50.000L).',
                poolPotential: 98,
                fitnessPotential: 85,
                strategy: 'Exclusividade Total',
                poolTip: 'Venda o "Sistema Livre de Cloro" como item de saúde indispensável. O cliente não pergunta preço, pergunta se é o melhor.',
                fitnessTip: 'Atendimento "Bag Delivery" com peças de grife. O foco é a roupa social-fitness para eventos do agronegócio.',
                color: 'bg-emerald-600'
            },
            {
                id: 'morada',
                name: 'Morada do Sol & Campestre',
                type: 'Classe Média Alta / Profissionais',
                class: 'A/B',
                income: '15-25 S.M.',
                description: 'Bairros consolidados, próximos aos clubes tradicionais. Público formado por médicos, advogados e agrônomos. Casas com piscinas médias.',
                poolPotential: 80,
                fitnessPotential: 95,
                strategy: 'Status Racional',
                poolTip: 'Foque na automação. Este cliente trabalha muito e quer a piscina pronta para uso no fim de semana sem esforço.',
                fitnessTip: 'Kits coordenados (legging + top). Valorizam marcas técnicas reconhecidas pela durabilidade.',
                color: 'bg-blue-600'
            },
            {
                id: 'universitario',
                name: 'Setor Universitário & Central',
                type: 'Jovem / Universitário / Dinâmico',
                class: 'B/C',
                income: '5-12 S.M.',
                description: 'Alta densidade vertical e repúblicas. O consumo de piscina é via Clubes e Academias, mas o consumo de moda fitness é explosivo.',
                poolPotential: 20,
                fitnessPotential: 99,
                strategy: 'Fast Fashion & Volume',
                poolTip: 'Mercado B2B: Venda ionizadores industriais para as academias e clubes da região (Life Club, etc).',
                fitnessTip: 'Coleções "Capsula" semanais. Influenciadores locais e estética de Instagram são vitais aqui.',
                color: 'bg-purple-600'
            },
            {
                id: 'promissao',
                name: 'Promissão & Bairros Populares',
                type: 'Classe Trabalhadora / Ascendente',
                class: 'C/D',
                income: '2-5 S.M.',
                description: 'A força de trabalho da agroindústria (BRF, Perdigão). Lazer focado em piscinas de plástico/fibra ou clubes associativos.',
                poolPotential: 40,
                fitnessPotential: 70,
                strategy: 'Acessibilidade',
                poolTip: 'Kits de tratamento simplificado para piscinas de fibra e infláveis de grande porte.',
                fitnessTip: 'Preço competitivo e facilidade de pagamento. Moda fitness que serve como roupa de dia a dia.',
                color: 'bg-orange-500'
            }
        ];

        const SEASONALITY_DATA = [
            { month: 'Jan', cashflow: 50, event: 'Manutenção', strategy: 'Liquidação de Estoque' },
            { month: 'Fev', cashflow: 80, event: 'Início Colheita Soja', strategy: 'Pré-Venda Safra (Tickets Altos)' },
            { month: 'Mar', cashflow: 100, event: 'Pico Soja (R$)', strategy: 'Lançamento Coleções Premium' },
            { month: 'Abr', cashflow: 90, event: 'Fim Colheita Soja', strategy: 'Fechamento de Obras/Reformas' },
            { month: 'Mai', cashflow: 60, event: 'Plantio Safrinha', strategy: 'Manutenção Recorrente' },
            { month: 'Jun', cashflow: 65, event: 'Expo Rio Verde', strategy: 'Moda "Agro-Chic" para a Festa' },
            { month: 'Jul', cashflow: 95, event: 'Colheita Milho', strategy: '2ª Onda de Liquidez (Férias)' },
            { month: 'Ago', cashflow: 70, event: 'Pós-Safra', strategy: 'Promoções de Inverno' },
            { month: 'Set', cashflow: 50, event: 'Vazio Sanitário', strategy: 'Preparação Verão / Fitness' },
            { month: 'Out', cashflow: 55, event: 'Plantio Verão', strategy: 'Campanha "Projeto Verão"' },
            { month: 'Nov', cashflow: 75, event: 'Esquenta Verão', strategy: 'Kits Químicos Piscina' },
            { month: 'Dez', cashflow: 90, event: '13º + Bônus', strategy: 'Presentes e Reformas Rápidas' }
        ];

        // --- COMPONENTES AUXILIARES ---

        const InteractiveBadge = ({ type = "click" }) => (
            <span className="inline-flex items-center gap-1 bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded-full border border-indigo-200 animate-pulse ml-2 whitespace-nowrap select-none">
                {type === "click" ? <Icons.MousePointerClick className="w-3 h-3" /> : <Icons.Edit3 className="w-3 h-3" />}
                {type === "click" ? "Interativo: Clique" : "Interativo: Edite"}
            </span>
        );

        const SourceFooter = ({ source, period }) => (
            <div className="mt-6 pt-4 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center text-[10px] text-slate-400 font-medium font-mono gap-2 w-full">
                <span className="flex items-center gap-1 shrink-0"><Icons.FileText className="w-3 h-3" /> {source}</span>
                <span className="bg-slate-100 px-2 py-0.5 rounded text-slate-500 whitespace-nowrap text-[9px] sm:text-[10px]">{period || SOURCES.periodo}</span>
            </div>
        );

        const SectionIntro = ({ title, icon: IconComponent, children, expertNote, interactiveType }) => (
            <div className="mb-6 w-full">
                <div className="bg-white p-4 md:p-5 rounded-lg border-l-4 border-indigo-500 shadow-sm w-full box-border">
                    <div className="flex flex-wrap items-center gap-2 mb-3">
                        <h2 className="text-lg md:text-xl font-bold text-slate-800 flex items-center gap-2">
                            <IconComponent className="w-5 h-5 md:w-6 md:h-6 text-indigo-600 flex-shrink-0" />
                            {title}
                        </h2>
                        {interactiveType && <InteractiveBadge type={interactiveType} />}
                    </div>
                    <div className="text-slate-600 text-xs md:text-sm leading-relaxed text-justify space-y-2">
                        {children}
                    </div>
                </div>
                {expertNote && (
                    <div className="mt-2 mx-2 md:mx-4 bg-indigo-50 p-3 rounded-b-lg border border-indigo-100 border-t-0 flex gap-3 items-start">
                        <Icons.Lightbulb className="w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5" />
                        <div>
                            <span className="block text-[10px] font-bold text-indigo-800 uppercase mb-1">Análise do Especialista</span>
                            <p className="text-xs text-indigo-700 italic leading-relaxed">{expertNote}</p>
                        </div>
                    </div>
                )}
            </div>
        );

        const MainCard = ({ title, value, icon: IconComponent, subtext, tooltip }) => (
            <div className="bg-white rounded-xl p-5 shadow-sm border border-slate-100 flex flex-col justify-between h-full relative group hover:shadow-md transition-shadow overflow-hidden w-full">
                <div className="flex items-start justify-between w-full">
                    <div className="p-3 bg-indigo-50 rounded-lg shrink-0">
                        <IconComponent className="w-5 h-5 md:w-6 md:h-6 text-indigo-600" />
                    </div>
                    {tooltip && (
                        <div className="relative group/tooltip ml-2">
                            <Icons.HelpCircle className="w-4 h-4 text-slate-300 cursor-help" />
                            <div className="absolute top-8 right-0 w-48 bg-slate-800 text-white text-[10px] p-3 rounded-lg hidden group-hover/block z-50 shadow-xl pointer-events-none leading-relaxed text-left border border-slate-200 bg-opacity-95">
                                {tooltip}
                            </div>
                        </div>
                    )}
                </div>
                <div className="mt-4 w-full">
                    <h3 className="text-[10px] md:text-xs font-bold uppercase tracking-wider text-slate-500 truncate" title={title}>{title}</h3>
                    <p className="text-lg md:text-2xl font-bold text-slate-800 mt-1 truncate" title={value}>{value}</p>
                    {subtext && <p className="text-[10px] md:text-xs text-slate-400 mt-2 border-t border-slate-100 pt-2 truncate">{subtext}</p>}
                </div>
            </div>
        );

        const ProgressBar = ({ label, value, colorClass }) => (
            <div className="mb-4 last:mb-0 w-full">
                <div className="flex justify-between mb-1">
                    <span className="text-xs md:text-sm font-medium text-slate-700">{label}</span>
                    <span className="text-xs md:text-sm font-medium text-slate-700">{value}%</span>
                </div>
                <div className="w-full bg-slate-200 rounded-full h-2">
                    <div className={`h-2 rounded-full ${colorClass}`} style={{ width: `${value}%` }}></div>
                </div>
            </div>
        );

        // --- SIMULADOR ---
        const BusinessSimulator = () => {
            const [capexItems, setCapexItems] = useState([
                { id: 1, name: 'Reforma / Ponto Comercial', value: 25000 },
                { id: 2, name: 'Estoque Inicial (Mix)', value: 40000 },
                { id: 3, name: 'Marketing & Branding', value: 8000 },
                { id: 4, name: 'Mobiliário e TI', value: 12000 },
            ]);

            const [opexItems, setOpexItems] = useState([
                { id: 1, name: 'Aluguel (Bairro Nobre)', value: 4500 },
                { id: 2, name: 'Equipe (2 func + encargos)', value: 6500 },
                { id: 3, name: 'Energia/Água/Net', value: 800 },
                { id: 4, name: 'Tráfego Pago (Ads)', value: 1500 },
            ]);

            const [revenue, setRevenue] = useState({
                avgTicket: 350, 
                volume: 60, 
                variableCostPct: 45 
            });

            const [isMounted, setIsMounted] = useState(false);
            useEffect(() => setIsMounted(true), []);

            const formatCurrency = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
            
            const addItem = (setter, list) => {
                const newId = list.length > 0 ? Math.max(...list.map(i => i.id)) + 1 : 1;
                setter([...list, { id: newId, name: 'Novo Item', value: 0 }]);
            };

            const removeItem = (setter, list, id) => {
                setter(list.filter(item => item.id !== id));
            };

            const updateItem = (setter, list, id, field, value) => {
                setter(list.map(item => item.id === id ? { ...item, [field]: field === 'value' ? Number(value) : value } : item));
            };

            const totalCapex = capexItems.reduce((acc, item) => acc + item.value, 0);
            const totalFixedOpex = opexItems.reduce((acc, item) => acc + item.value, 0);
            
            const grossRevenue = revenue.avgTicket * revenue.volume;
            const variableCost = grossRevenue * (revenue.variableCostPct / 100);
            const contributionMargin = grossRevenue - variableCost;
            const netProfit = contributionMargin - totalFixedOpex;
            
            const paybackMonths = netProfit > 0 ? totalCapex / netProfit : 0;
            const paybackYears = paybackMonths / 12;

            const simulatorData = [
                { name: 'Receita Bruta', value: grossRevenue, color: '#22c55e' }, 
                { name: 'Custo Variável', value: variableCost, color: '#f59e0b' }, 
                { name: 'Custo Fixo', value: totalFixedOpex, color: '#ef4444' }, 
                { name: 'Lucro Líq.', value: netProfit > 0 ? netProfit : 0, color: '#3b82f6' } 
            ];

            return (
                <div className="bg-white rounded-xl shadow-lg border border-indigo-100 overflow-hidden mt-8 w-full max-w-full box-border">
                    <div className="bg-indigo-900 text-white p-5 flex items-center justify-between flex-wrap gap-2">
                        <div>
                            <h3 className="text-lg font-bold flex items-center gap-2">
                                <Icons.Calculator className="w-5 h-5 text-green-400" />
                                Simulador de Viabilidade
                            </h3>
                            <p className="text-[10px] text-indigo-300 mt-1 flex items-center gap-1">
                                <Icons.Edit3 className="w-3 h-3" />
                                Preencha os campos abaixo para simular seu cenário
                            </p>
                        </div>
                        <button type="button" onClick={() => window.confirm("Deseja redefinir?") && window.location.reload()} className="text-xs bg-indigo-800 hover:bg-indigo-700 px-3 py-1 rounded text-indigo-200 flex items-center gap-1 transition-colors">
                            <Icons.RefreshCw className="w-3 h-3" /> Reset
                        </button>
                    </div>

                    <div className="p-4 md:p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 w-full">
                        {/* COLUNA ESQUERDA: INPUTS */}
                        <div className="space-y-6 w-full min-w-0">
                            {/* CAPEX */}
                            <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 w-full">
                                <div className="flex justify-between items-center mb-3">
                                    <div className="flex items-center gap-2">
                                        <Icons.Target className="w-4 h-4 text-indigo-600" />
                                        <h4 className="text-sm font-bold text-slate-700 uppercase">CAPEX (Inicial)</h4>
                                    </div>
                                    <button type="button" onClick={() => addItem(setCapexItems, capexItems)} className="p-1 bg-white hover:bg-indigo-50 border border-slate-200 rounded-full text-indigo-600 shadow-sm"><Icons.Plus className="w-4 h-4" /></button>
                                </div>
                                <div className="space-y-2 max-h-40 overflow-y-auto pr-1">
                                    {capexItems.map((item) => (
                                        <div key={item.id} className="flex gap-2 items-center text-xs w-full">
                                            <div className="flex-1 relative min-w-0">
                                                <Icons.Edit3 className="w-3 h-3 text-slate-300 absolute left-2 top-2.5" />
                                                <input type="text" value={item.name} onChange={(e) => updateItem(setCapexItems, capexItems, item.id, 'name', e.target.value)} className="w-full border border-slate-300 rounded pl-7 pr-2 py-2 focus:ring-1 focus:ring-indigo-500 outline-none min-w-0 bg-white" style={{ fontSize: '16px' }} placeholder="Item" />
                                            </div>
                                            <div className="relative shrink-0" style={{ width: '100px' }}>
                                                <span className="absolute left-2 top-2 text-slate-400">R$</span>
                                                <input type="number" value={item.value} onChange={(e) => updateItem(setCapexItems, capexItems, item.id, 'value', e.target.value)} className="w-full pl-7 border border-slate-300 rounded px-2 py-2 text-right outline-none bg-white focus:ring-1 focus:ring-indigo-500" style={{ fontSize: '16px' }} />
                                            </div>
                                            <button type="button" onClick={() => removeItem(setCapexItems, capexItems, item.id)} className="text-slate-400 hover:text-red-500 shrink-0"><Icons.Trash2 className="w-3 h-3" /></button>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-3 text-right text-xs font-bold text-indigo-900 bg-indigo-100 p-2 rounded">Total: {formatCurrency(totalCapex)}</div>
                            </div>

                            {/* OPEX */}
                            <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 w-full">
                                <div className="flex justify-between items-center mb-3">
                                    <div className="flex items-center gap-2">
                                        <Icons.RefreshCw className="w-4 h-4 text-orange-600" />
                                        <h4 className="text-sm font-bold text-slate-700 uppercase">OPEX (Mensal)</h4>
                                    </div>
                                    <button type="button" onClick={() => addItem(setOpexItems, opexItems)} className="p-1 bg-white hover:bg-indigo-50 border border-slate-200 rounded-full text-indigo-600 shadow-sm"><Icons.Plus className="w-4 h-4" /></button>
                                </div>
                                <div className="space-y-2 max-h-40 overflow-y-auto pr-1">
                                    {opexItems.map((item) => (
                                        <div key={item.id} className="flex gap-2 items-center text-xs w-full">
                                            <div className="flex-1 relative min-w-0">
                                                <Icons.Edit3 className="w-3 h-3 text-slate-300 absolute left-2 top-2.5" />
                                                <input type="text" value={item.name} onChange={(e) => updateItem(setOpexItems, opexItems, item.id, 'name', e.target.value)} className="w-full border border-slate-300 rounded pl-7 pr-2 py-2 focus:ring-1 focus:ring-indigo-500 outline-none min-w-0 bg-white" style={{ fontSize: '16px' }} placeholder="Item" />
                                            </div>
                                            <div className="relative shrink-0" style={{ width: '100px' }}>
                                                <span className="absolute left-2 top-2 text-slate-400">R$</span>
                                                <input type="number" value={item.value} onChange={(e) => updateItem(setOpexItems, opexItems, item.id, 'value', e.target.value)} className="w-full pl-7 border border-slate-300 rounded px-2 py-2 text-right outline-none bg-white focus:ring-1 focus:ring-indigo-500" style={{ fontSize: '16px' }} />
                                            </div>
                                            <button type="button" onClick={() => removeItem(setOpexItems, opexItems, item.id)} className="text-slate-400 hover:text-red-500 shrink-0"><Icons.Trash2 className="w-3 h-3" /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* VENDAS */}
                            <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 w-full">
                                <div className="flex items-center gap-2 mb-3">
                                    <Icons.TrendingUp className="w-4 h-4 text-green-600" />
                                    <h4 className="text-sm font-bold text-slate-700 uppercase">Projeção Vendas</h4>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 w-full">
                                    <div className="relative w-full">
                                        <label className="text-[10px] uppercase font-bold text-slate-500 block mb-1">Ticket Médio</label>
                                        <div className="relative w-full">
                                            <Icons.Edit3 className="w-3 h-3 text-slate-300 absolute left-2 top-2.5" />
                                            <input type="number" value={revenue.avgTicket} onChange={(e) => setRevenue({...revenue, avgTicket: Number(e.target.value)})} className="w-full border border-slate-300 rounded pl-7 pr-2 py-2 bg-white focus:ring-1 focus:ring-indigo-500 outline-none" style={{ fontSize: '16px' }} />
                                        </div>
                                    </div>
                                    <div className="relative w-full">
                                        <label className="text-[10px] uppercase font-bold text-slate-500 block mb-1">Qtd. Vendas/Mês</label>
                                        <div className="relative w-full">
                                            <Icons.Edit3 className="w-3 h-3 text-slate-300 absolute left-2 top-2.5" />
                                            <input type="number" value={revenue.volume} onChange={(e) => setRevenue({...revenue, volume: Number(e.target.value)})} className="w-full border border-slate-300 rounded pl-7 pr-2 py-2 bg-white focus:ring-1 focus:ring-indigo-500 outline-none" style={{ fontSize: '16px' }} />
                                        </div>
                                    </div>
                                    <div className="relative w-full">
                                        <label className="text-[10px] uppercase font-bold text-slate-500 block mb-1">Custo Variável (%)</label>
                                        <div className="relative w-full">
                                            <Icons.Edit3 className="w-3 h-3 text-slate-300 absolute left-2 top-2.5" />
                                            <input type="number" value={revenue.variableCostPct} onChange={(e) => setRevenue({...revenue, variableCostPct: Number(e.target.value)})} className="w-full border border-slate-300 rounded pl-7 pr-2 py-2 bg-white focus:ring-1 focus:ring-indigo-500 outline-none" style={{ fontSize: '16px' }} />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* COLUNA DIREITA: RESULTADOS */}
                        <div className="flex flex-col h-full bg-slate-50 rounded-xl border border-slate-200 p-4 md:p-6 w-full min-w-0 box-border">
                            <h4 className="text-sm font-bold text-slate-800 uppercase mb-4 flex items-center gap-2">
                                <Icons.DollarSign className="w-4 h-4 text-emerald-600" />
                                Demonstrativo de Resultados (DRE)
                            </h4>
                            
                            <div className="w-full mb-6 relative" style={{ height: '220px' }}>
                                {isMounted && (
                                    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0 }}>
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={simulatorData} layout="vertical" margin={{top: 0, right: 10, left: 10, bottom: 0}}>
                                                <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                                <XAxis type="number" hide />
                                                <YAxis dataKey="name" type="category" width={85} tick={{fontSize: 10}} />
                                                <Tooltip cursor={{fill: 'transparent'}} formatter={(val) => formatCurrency(val)} contentStyle={{ zIndex: 1000 }} />
                                                <Bar dataKey="value" radius={[0, 4, 4, 0]} barSize={24}>
                                                    {simulatorData.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}
                                                </Bar>
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                )}
                            </div>

                            <div className="space-y-3 flex-1 w-full">
                                <div className="flex justify-between text-xs border-b border-slate-200 pb-2"><span className="text-slate-600">Receita Bruta</span><span className="font-bold text-slate-800">{formatCurrency(grossRevenue)}</span></div>
                                <div className="flex justify-between text-xs border-b border-slate-200 pb-2"><span className="text-slate-600">(-) Custos Variáveis</span><span className="font-medium text-orange-600">{formatCurrency(variableCost)}</span></div>
                                <div className="flex justify-between text-xs border-b border-slate-200 pb-2"><span className="text-slate-600">(-) Custo Fixo (OPEX)</span><span className="font-medium text-red-600">{formatCurrency(totalFixedOpex)}</span></div>
                                <div className={`flex justify-between text-sm p-3 rounded-lg mt-2 ${netProfit > 0 ? 'bg-green-100 text-green-900' : 'bg-red-100 text-red-900'}`}><span className="font-bold uppercase">Lucro Líquido</span><span className="font-bold">{formatCurrency(netProfit)}</span></div>
                            </div>

                            <div className="mt-6 pt-4 border-t-2 border-dashed border-slate-300 w-full">
                                <div className="flex items-center gap-2 mb-2">
                                    <span className="text-xs font-bold text-indigo-600 uppercase">Payback Estimado</span>
                                    <Icons.HelpCircle className="w-3 h-3 text-slate-400" title="Tempo para recuperar o investimento" />
                                </div>
                                {netProfit > 0 ? (
                                    <div className="flex items-baseline gap-2">
                                        <span className="text-3xl font-black text-slate-800">{paybackMonths.toFixed(1)}</span>
                                        <span className="text-sm font-medium text-slate-500">meses</span>
                                    </div>
                                ) : (
                                    <div className="flex items-center gap-2 text-red-500 bg-red-50 p-2 rounded text-xs"><Icons.AlertCircle className="w-4 h-4" /><span>Prejuízo</span></div>
                                )}
                            </div>
                        </div>
                    </div>
                    <div className="bg-slate-100 p-3 text-[10px] text-slate-500 text-center border-t border-slate-200">* Simulação simplificada para fins didáticos.</div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function RioVerdeApp() {
            const [activeZone, setActiveZone] = useState(ZONES[0]);
            const [filterClass, setFilterClass] = useState('all');
            const [isMounted, setIsMounted] = useState(false);

            useEffect(() => setIsMounted(true), []);

            const filteredZones = filterClass === 'all' ? ZONES : ZONES.filter(z => z.class.includes(filterClass));

            return (
                <div className="w-full max-w-[100vw] overflow-x-hidden">
                    <header className="bg-gradient-to-r from-indigo-900 to-blue-900 text-white p-5 md:p-8 shadow-xl">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex-1 text-center md:text-left">
                                <span className="bg-green-400 text-indigo-900 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase">Mapeamento 2025</span>
                                <h1 className="text-2xl md:text-4xl font-bold mt-2">Inteligência de Mercado<span className="block md:inline text-indigo-200 text-lg md:text-3xl font-light"> | Rio Verde</span></h1>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="bg-white/10 p-3 rounded-lg text-right hidden sm:block">
                                    <div className="text-[10px] uppercase">PIB per Capita</div>
                                    <div className="text-xl font-bold text-green-400">{CITY_STATS.pibPerCapita}</div>
                                </div>
                                <img src="https://i.postimg.cc/QtSXCKyV/taq-ions-removebg-preview.png" alt="TAQ Ions" className="h-16 w-auto object-contain" />
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-4 space-y-8">
                        
                        {/* KPI MOBILE */}
                        <div className="sm:hidden bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex justify-between items-center">
                            <div className="text-xs text-slate-500 font-bold uppercase">PIB per Capita</div>
                            <div className="text-lg font-bold text-green-600">{CITY_STATS.pibPerCapita}</div>
                        </div>

                        <SectionIntro title="Panorama Demográfico" icon={Icons.Users} expertNote="Dados atualizados com a prévia do IBGE 2025: Rio Verde atinge a 2ª posição no PIB estadual.">
                            <p>Rio Verde (<strong>{CITY_STATS.populacao} hab.</strong>) assumiu o posto de <strong>2ª maior economia de Goiás</strong>, superando Anápolis com um PIB de R$ 22,3 Bi.</p>
                        </SectionIntro>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <MainCard title="População (2025)" value={CITY_STATS.populacao} icon={Icons.Users} subtext="Estimativa IBGE" />
                            <MainCard title="PIB Total" value={CITY_STATS.pibTotal} icon={Icons.DollarSign} subtext="2º Maior de GO" />
                            <MainCard title="Público Alvo" value="Classe A/B" icon={Icons.Droplets} subtext="Alta Renda" />
                            <MainCard title="Consumo" value="R$ 7 Bi+" icon={Icons.TrendingUp} subtext="Potencial/Ano" />
                        </div>

                        <SectionIntro title="Geografia do Consumo" icon={Icons.MapPin} interactiveType="click">
                            <p>Clique nas zonas abaixo para ver a estratégia de vendas recomendada.</p>
                        </SectionIntro>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="lg:col-span-2 space-y-4">
                                <div className="flex gap-2 overflow-x-auto pb-2">
                                    {['all', 'A', 'B', 'C'].map(cls => (
                                        <button key={cls} onClick={() => setFilterClass(cls)} className={`px-4 py-1.5 text-xs font-bold rounded-full whitespace-nowrap ${filterClass === cls ? 'bg-indigo-600 text-white' : 'bg-white text-slate-500 border'}`}>{cls === 'all' ? 'Todas as Zonas' : `Classe ${cls}`}</button>
                                    ))}
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                    {filteredZones.map(zone => (
                                        <button key={zone.id} onClick={() => setActiveZone(zone)} className={`p-4 rounded-xl border-2 text-left transition-all ${activeZone.id === zone.id ? 'border-indigo-600 bg-white shadow-lg' : 'border-white bg-white hover:border-indigo-200'}`}>
                                            <div className={`w-3 h-3 rounded-full ${zone.color} mb-2`}></div>
                                            <h3 className="font-bold text-slate-800 text-sm">{zone.name}</h3>
                                            <p className="text-[10px] text-slate-500 mt-1">{zone.type}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="bg-white rounded-xl shadow-lg border border-indigo-100 p-5 relative">
                                <div className={`absolute top-0 left-0 w-full h-1.5 ${activeZone.color}`}></div>
                                <h2 className="text-lg font-bold text-slate-800 mt-2">{activeZone.name}</h2>
                                <p className="text-xs text-slate-600 mt-2 italic border-l-2 pl-2">"{activeZone.description}"</p>
                                <div className="mt-4 space-y-3">
                                    <div className="p-3 bg-slate-50 rounded">
                                        <ProgressBar label="Potencial Piscinas" value={activeZone.poolPotential} colorClass="bg-blue-500" />
                                        <ProgressBar label="Potencial Fitness" value={activeZone.fitnessPotential} colorClass="bg-pink-500" />
                                    </div>
                                    <div className="text-xs p-2 bg-blue-50 text-blue-900 rounded border border-blue-100"><strong>Estratégia:</strong> {activeZone.poolTip}</div>
                                </div>
                            </div>
                        </div>

                        <SectionIntro title="Ciclo Financeiro (Safra)" icon={Icons.Calendar} expertNote="Picos de venda em Março e Julho.">
                            <p>Acompanhe a entrada de dinheiro na cidade conforme a colheita.</p>
                        </SectionIntro>

                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                            <div style={{ height: '300px', width: '100%', position: 'relative' }}>
                                {isMounted && (
                                    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0 }}>
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={SEASONALITY_DATA} margin={{ top: 5, right: 10, bottom: 5, left: -20 }}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                                <XAxis dataKey="month" axisLine={false} tickLine={false} tick={{fill: '#64748b', fontSize: 10}} />
                                                <YAxis hide />
                                                <Tooltip />
                                                <Legend verticalAlign="top" height={36} />
                                                <Line type="monotone" dataKey="cashflow" stroke="#22c55e" strokeWidth={3} dot={{r:4}} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                )}
                            </div>
                        </div>

                        <SectionIntro title="Simulador de Negócios" icon={Icons.Calculator}>
                            <p>Projete a viabilidade do seu negócio inserindo os dados abaixo.</p>
                        </SectionIntro>
                        <BusinessSimulator />
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RioVerdeApp />);
    </script>
</body>
</html>
